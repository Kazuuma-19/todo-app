FROM openjdk:21-jdk-slim

WORKDIR /app

# Gradle Wrapper 関連ファイルを先にコピー（依存キャッシュのため）
COPY gradlew build.gradle settings.gradle /app/
COPY gradle /app/gradle

# 初期ビルドで依存ダウンロード（失敗しても継続）
RUN ./gradlew build --no-daemon || true

# アプリ全体をコピー（後で volume で上書きされる）
COPY . /app

# ホットリロード対応で bootRun 実行
CMD ["./gradlew", "bootRun", "--no-daemon"]

EXPOSE 8080
